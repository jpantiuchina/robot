package com.mycompany.myapplication;import android.annotation.SuppressLint;import android.bluetooth.BluetoothAdapter;import android.bluetooth.BluetoothDevice;import android.bluetooth.BluetoothSocket;import android.content.BroadcastReceiver;import android.content.Context;import android.content.Intent;import android.content.IntentFilter;import android.media.Ringtone;import android.media.RingtoneManager;import android.net.Uri;import android.os.Bundle;import android.support.v7.app.AppCompatActivity;import android.util.Log;import android.view.Menu;import android.view.MenuItem;import android.view.View;import com.mycompany.myapplication.robot.Robot;import com.mycompany.myapplication.robot.SensorData;import java.io.IOException;import java.util.UUID;public class MainActivity extends AppCompatActivity{    public static final String TAG = "MainActivity";    private static final int REQUEST_ENABLE_BT = 546;//    private static final String MY_DEVICE_NAME = "new-lenovo";    private static final String MY_DEVICE_NAME = "HC-06";    BluetoothAdapter bluetoothAdapter;    BluetoothDevice device;    BluetoothSocket socket;    Robot robot;    @Override    protected void onCreate(Bundle savedInstanceState)    {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        bluetoothAdapter = BluetoothAdapter.getDefaultAdapter();        if (bluetoothAdapter == null)            throw new RuntimeException("Device does not support bluetooth");        if (!bluetoothAdapter.isEnabled())        {            Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);            startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);        }        IntentFilter filter = new IntentFilter(BluetoothDevice.ACTION_FOUND);        registerReceiver(bluetoothDeviceFoundReceiver, filter);        if (bluetoothAdapter.isEnabled())            startDiscovery();    }    @Override    protected void onActivityResult(int requestCode, int resultCode, Intent data)    {        if (requestCode == REQUEST_ENABLE_BT)        {            if (resultCode == RESULT_OK)                startDiscovery();            else                throw new RuntimeException("Cannot work with disabled Bluetooth.");        }        super.onActivityResult(requestCode, resultCode, data);    }    @Override    protected void onDestroy()    {        if (socket != null)        {            try            {                socket.close();            }            catch (IOException e)            {                e.printStackTrace();            }        }        unregisterReceiver(bluetoothDeviceFoundReceiver);        super.onDestroy();    }    private void startDiscovery()    {        Log.i(TAG, "Searching for device " + MY_DEVICE_NAME);        bluetoothAdapter.startDiscovery();    }    private void bluetoothDeviceFound(BluetoothDevice device) throws Exception    {        Log.i(TAG, "Found Bluetooth device " + device.getName() + " " + device.getAddress());        if (!MY_DEVICE_NAME.equals(device.getName()))            return;        this.device = device;        Log.i(TAG, "Connecting to this device");        UUID uuid = device.getUuids()[0].getUuid();        Log.i(TAG, "Connecting to UUID " + uuid);        socket = device.createRfcommSocketToServiceRecord(uuid);        bluetoothAdapter.cancelDiscovery(); // Save resources and prevent double connects        try        {            socket.connect();        }        catch (IOException e)        {            socket.close();            Log.e(TAG, "Cannot connect", e);            throw new RuntimeException(e);        }        Log.i(TAG, "Successfully connected");        robot = new Robot(socket.getInputStream(), socket.getOutputStream());        while (true)        {            SensorData sensorData = robot.scan(128, 128);            Log.i(TAG, sensorData.toString());            Thread.sleep(1000);        }    }    public void turnLeft(View view)    {        Uri notification = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);        Ringtone r = RingtoneManager.getRingtone(getApplicationContext(), notification);        r.play();    }    private final BroadcastReceiver bluetoothDeviceFoundReceiver = new BroadcastReceiver()    {        @Override        public void onReceive(Context context, Intent intent)        {            BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);            try            {                bluetoothDeviceFound(device);            }            catch (Exception e)            {                Log.e(TAG, "Error in device discovery", e);//                throw new RuntimeException(e);            }        }    };}